## 2 yaflib 功能介绍与入门

在前面我们已经对 `yaflib` 做了一些粗浅介绍。本小节我们将对 `yaflib` 做详细的功能介绍以及快速的入门使用。

### 2.1 功能概览

#### 2.1.1 MySQL ORM

实现了简单的 `Model`。同时也支持原生 `SQL` 操作。由于历史原因，该库内置了阿里云 `RDS` 主从支持。

#### 2.1.2 缓存

通过 `Redis` 与 `MySQL` 来实现数据的存储。虽然支持 `MySQL`，但是不推荐使用 `MySQL` 来做数据库缓存。如果使用 `MySQL` 驱动的话，必须创建一张 `MySQL` 表来存储。其性能与功能上都非常弱。后续会增加 `ssdb` 中间件的支持。

#### 2.1.3 Session 分布式

在如今 `Web` 服务器数量不再单一的情况下，`Session` 分布式存储也变成了标配。目前提供 `Redis` 与 `MySQL` 两种驱动，但是不推荐使用 `MySQL`。后续也会删掉对 `MySQL` 的支持。考虑增加 `ssdb` 中间件的支持。

#### 2.1.4 文件上传

文件上传可谓是 `Web` 开发的标配。目前支持上传到本地以及阿里云 `OSS` 存储两种模式。通常我们不太推荐上传到本地的方式。因为它会大量占用磁盘空间，在用户量大的时候文件的浏览会导致带宽占满影响正常的请求。并且，使用诸如阿里云`OSS` 这一类的云产品可以使用 CDN 加速和图片防盗链、权限管理等功能。

#### 2.1.5 图片处理

图片处理包含：水印、裁剪、缩略图、图片基本信息读取等功能。足以满足当前 `Web` 开发的需求。如果想通过 `PHP` 来实现图床功能，作者不推荐这么做。

#### 2.1.6 多进程

在开发过程中，可能会对一些特定任务（短信发送、APP Push、邮件通知）进行处理。通常我们会使用一个脚本一直在后台处理。当处理太慢时，把把脚本启动多次来解决。虽然能解决问题。但是，并不优雅和高效。所以，多进程的任务管理就显得特别重要且必要。

#### 2.1.7 验证器

您是否厌倦了写一大段的 `if else` 判断逻辑来验证用户提交的参数合法性？那么，我们的 `yaflib` 提供了一个简洁高效的验证器。能让您从繁琐的验证之中解脱出来。代码也简洁了，心情自然也就好起来了。

#### 2.1.8 验证码

验证码的重要性相信大家都非常明白。可谓使用相当广泛。不过，近些年由于人机验证码的出现。图片验证码已经逐渐退出了历史舞台。

#### 2.1.9 分布式锁

在如今的时代，服务器数量几何级上涨，资源的竞争是必须存在。那么，一个分布式锁就显得极为必要且重要。`yaflib` 的分布式锁通过 `redis` 实现。

#### 2.1.10 分页

分页是 `web` 系统当中最基础核心的组成部分。

#### 2.1.11 Cookie

`Cookie` 的操作非常之重要。封装是为了有统一操作 `API` 接口。以及规避明文存储 `Cookie` 导致的敏感信息的泄漏。

#### 2.1.12 日志

提供方便快捷的日志记录功能。日志记录的时候会同时记录服务器 IP、用户 IP。以快速排查各种与服务器相关的问题。

#### 2.1.13 加解密

提供了对称加密、非对称加密、带有效期的加解密功能。该功能通常用于各位 API 接口设计以及 TOKEN 令牌的场景。

#### 2.1.14 Excel 导入导出

使用 `phpexcel` 库实现 Excel 的导入导出。`yaflib` 封装了一个简洁好用的方法，快捷实现 Excel 的导入导出。当然，Excel 的更多高级功能并未实现。只实现基础的带标题的 Excel 数据导入导出。

#### 2.1.15 数组快捷取值

如下：

```php
$data = [
	'id'   => 1,
	'name' => 'fingerQin'
];

finger\DataInput::getInt('id', 1); // id 值不存在的时候设置返回值为 1。
```

大家可以发现，我们免除了繁琐的 `issst` 的判断。同时增加了类型的判断，并且在 `id` 不存在时返回 1 等各种便捷的骚操作。

#### 2.1.16 日期工具类

我们经常会有需求计算日期对应的生肖、星座、以及实现多久之前的需求。那么，正好 `yaflib` 提供了这样的方法。

#### 2.1.17 目录操作工具类

像获取文件大小以我们熟知的 `KB`、`MB`、`GB` 来展示。以及以树结构返回目录列表。其他常见的创建、删除等功能。

#### 2.1.18 浏览器检测

我们通常会有根据用户访问的浏览器是手机还是 PC 来做域名的跳转。这应该非常有用。

#### 2.1.19 随机金额

微信红包的金额随机大家应该很了解 。那么，我们也实现了该功能。

#### 2.1.20 字符串工具类

`PHP` 内置的字符串方法虽然功能强大。但是也并未实现我们想要的更多功能。比如：随机指定长度字符串、`xss` 过滤、字符串截取、数据脱敏等。

#### 2.1.21 URL 

获取当前 `URL` 地址。

#### 2.1.22 IP

获取当前 `IP`，以及提供一个范围 `IP` 的判断。特别是范围 `IP` 可以结合很多与 `IP` 相关限制功能。

### 2.2 快速入门

虽然 `yaflib` 是针对 `Yaf` 框架先天功能不足而设计的类库。但它并不局限于 `Yaf` 框架。

#### 2.2.1 安装 yaflib

先确定您的环境已经正常安装 `PHP ` 包管理工具 `Composer` 。以下命令没有特殊注明，均在 `Linux` 环境下操作。

```
> cd ~
> mkdir project
> cd project
> composer require finger/yaflib 2.0.8
```

以上的意思就创建一个 `project` 名称的项目。然后在该项目下面使用 Composer 包管理工具安装 `yaflib 2.0.8`

版本。

#### 2.2.1 使用 yaflib

在 `project` 项目下创建一个 `index.php` 。写入如下代码：

```php
<?php
// 定义项目根目录常量。
define('APP_PATH', __DIR__);
// 加载 composer 包管理器的自动加载文件。
require(APP_PATH . '/vendor/autoload.php');

$config = [];
(new \finger\App($config));

\finger\App::log('我是日志', 'debug', 'log');
```

就这样我们就实现了 `yaflib` 类库的加载并使用。完成了调用 `yaflib` 类库的 `App::log()` 写日志的功能。

```php
$config = [];
(new \finger\App($config));
```

这两行代码非常关键。因为我们在调用与日志、`Redis`、`MySQL`、`Aliyun OSS` 等等功能时，会读取通过这两行代码载入的配置信息。关于配置的介绍，我们会在后面的章节中慢慢介绍。





